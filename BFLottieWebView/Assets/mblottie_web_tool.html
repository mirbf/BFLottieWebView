<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <style>
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: transparent;
        overflow: hidden;
      }
      #container {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #lottie {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="container"><div id="lottie"></div></div>

    <script src="lottie.min.js" onerror="try{window.webkit.messageHandlers.mblottie.postMessage({type:'error',payload:'Failed to load lottie.min.js'})}catch(e){}"></script>
    <script>
      (function() {
        function post(type, payload) {
          try {
            window.webkit.messageHandlers.mblottie.postMessage({ type: type, payload: payload });
          } catch (e) {}
        }

        window.addEventListener("error", function(e) {
          var msg = "JS error: " + (e && e.message ? e.message : "");
          msg += " @" + (e && e.filename ? e.filename : "");
          msg += ":" + (e && e.lineno ? e.lineno : 0) + ":" + (e && e.colno ? e.colno : 0);
          try { if (e && e.error && e.error.stack) msg += "\n" + e.error.stack; } catch (x) {}
          post("error", msg);
        });

        window.addEventListener("unhandledrejection", function(e) {
          var r = (e && e.reason) ? e.reason : null;
          var msg = "Unhandled rejection: " + (r && r.message ? r.message : String(r));
          try { if (r && r.stack) msg += "\n" + r.stack; } catch (x) {}
          post("error", msg);
        });

        function selfTest() {
          var has = !!window.lottie;
          var ver = null;
          try {
            ver = window.lottie && (window.lottie.version || null);
          } catch (e) {}
          return {
            hasLottie: has,
            lottieVersion: ver,
            ua: (navigator && navigator.userAgent) ? navigator.userAgent : ""
          };
        }

        function b64ToUtf8(b64) {
          var bin = atob(b64);
          var bytes = new Uint8Array(bin.length);
          for (var i = 0; i < bin.length; i++) bytes[i] = bin.charCodeAt(i);

          if (window.TextDecoder) {
            try { return new TextDecoder("utf-8").decode(bytes); } catch (e) {}
          }

          try { return decodeURIComponent(escape(bin)); } catch (e) { return bin; }
        }

        var state = { anim: null, hasFirstFrame: false };

        function destroyAnim() {
          if (state.anim) {
            try { state.anim.destroy(); } catch (e) {}
            state.anim = null;
          }
          state.hasFirstFrame = false;
          var el = document.getElementById("lottie");
          if (el) el.innerHTML = "";
        }

        function markFirstFrame() {
          if (!state.hasFirstFrame) {
            state.hasFirstFrame = true;
            post("firstFrame", null);
          }
        }

        window.__loadLottieBase64 = function(b64, opts) {
          try {
            if (!window.lottie) {
              post("error", "lottie-web not loaded");
              return false;
            }

            destroyAnim();

            var el = document.getElementById("lottie");
            if (!el) {
              post("error", "Missing #lottie container");
              return false;
            }

            opts = opts || {};
            var renderer = (opts.renderer === "canvas") ? "canvas" : "svg";
            var loop = !!opts.loop;
            var autoplay = !!opts.autoplay;
            var speed = (typeof opts.speed === "number") ? opts.speed : 1.0;

            var jsonText = b64ToUtf8(b64);
            var data;
            try {
              data = JSON.parse(jsonText);
            } catch (e) {
              post("error", "Invalid JSON: " + (e && e.message ? e.message : String(e)));
              return false;
            }

            state.anim = window.lottie.loadAnimation({
              container: el,
              renderer: renderer,
              loop: loop,
              autoplay: autoplay,
              animationData: data,
              rendererSettings: {
                progressiveLoad: false,
                clearCanvas: true
              }
            });

            try { state.anim.setSpeed(speed); } catch (e) {}

            state.anim.addEventListener("DOMLoaded", function() {
              // Render the first frame even when `autoplay` is false.
              try { state.anim.goToAndStop(0, true); } catch (e) {}
              markFirstFrame();
              post("loaded", { v: selfTest().lottieVersion, renderer: renderer });
            });

            state.anim.addEventListener("enterFrame", function() {
              markFirstFrame();
            });

            return true;
          } catch (e) {
            var msg = (e && e.message) ? e.message : String(e);
            try { if (e && e.stack) msg += "\n" + e.stack; } catch (x) {}
            post("error", msg);
            return false;
          }
        };

        window.__play = function() {
          try { if (state.anim) state.anim.play(); } catch (e) {}
        };

        window.__pause = function() {
          try { if (state.anim) state.anim.pause(); } catch (e) {}
        };

        window.__stop = function() {
          try { if (state.anim) state.anim.stop(); } catch (e) {}
        };

        window.__setLoop = function(loop) {
          try {
            if (state.anim) state.anim.loop = !!loop;
          } catch (e) {}
        };

        window.__setProgress = function(progress01) {
          try {
            if (!state.anim) return;
            var p = Math.max(0, Math.min(1, progress01));
            var total = state.anim.totalFrames || 0;
            var frame = total ? (p * total) : 0;
            state.anim.goToAndStop(frame, true);
            markFirstFrame();
          } catch (e) {}
        };

        window.__setSpeed = function(speed) {
          try { if (state.anim) state.anim.setSpeed(speed); } catch (e) {}
        };

        window.__selfTest = function() {
          return selfTest();
        };

        post("ready", selfTest());
      })();
    </script>
  </body>
</html>
